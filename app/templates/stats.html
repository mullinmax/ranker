{% extends "base.html" %}
{% block title %}Statistics{% endblock %}
{% block content %}
<h2>Global ELO Ranking</h2>
{% if elo_ranking %}
<table class="stats-table">
  <tr><th>#</th><th>Preview</th><th>Media</th><th>ELO</th></tr>
  {% for media, elo in elo_ranking %}
  <tr>
    <td>{{ loop.index }}</td>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.1f' % elo }}</td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No rankings yet.</p>
{% endif %}
<h2>Your Highest Rated Media</h2>
{% if user_highest %}
<table class="stats-table">
  <tr><th>Preview</th><th>Media</th><th>Your Avg</th><th>Global Avg</th></tr>
  {% for media, user_score, global_score in user_highest %}
  <tr>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.2f' % user_score }}</td>
    <td>{{ '%.2f' % global_score if global_score is not none else 'N/A' }}</td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No ratings yet.</p>
{% endif %}

<h2>Global Highest Rated Media</h2>
{% if global_highest %}
<table class="stats-table">
  <tr><th>Preview</th><th>Media</th><th>Global Avg</th><th>Your Avg</th></tr>
  {% for media, global_score, user_score in global_highest %}
  <tr>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.2f' % global_score }}</td>
    <td>{{ '%.2f' % user_score if user_score is not none else 'N/A' }}</td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No ratings yet.</p>
{% endif %}

<h2>Your Lowest Rated Media</h2>
{% if user_lowest %}
<table class="stats-table">
  <tr><th>Preview</th><th>Media</th><th>Your Avg</th><th>Global Avg</th></tr>
  {% for media, user_score, global_score in user_lowest %}
  <tr>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.2f' % user_score }}</td>
    <td>{{ '%.2f' % global_score if global_score is not none else 'N/A' }}</td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No ratings yet.</p>
{% endif %}

<h2>Global Lowest Rated Media</h2>
{% if global_lowest %}
<table class="stats-table">
  <tr><th>Preview</th><th>Media</th><th>Global Avg</th><th>Your Avg</th></tr>
  {% for media, global_score, user_score in global_lowest %}
  <tr>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.2f' % global_score }}</td>
    <td>{{ '%.2f' % user_score if user_score is not none else 'N/A' }}</td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No ratings yet.</p>
{% endif %}

<h2>Media Summary</h2>
<p>Total files: {{ media_total }}</p>
<ul>
  {% for name, count in media_counts %}
  <li>{{ name }}: {{ count }}</li>
  {% endfor %}
</ul>
<h2>ELO Stats by Name</h2>
{% if name_group_stats %}
<table class="stats-table">
  <tr><th>Name</th><th>Count</th><th>Min</th><th>Max</th><th>Avg</th><th>Stddev</th></tr>
  {% for name, count, mn, mx, avg, std in name_group_stats %}
  <tr>
    <td>{{ name }}</td>
    <td>{{ count }}</td>
    <td>{{ '%.1f' % mn }}</td>
    <td>{{ '%.1f' % mx }}</td>
    <td>{{ '%.1f' % avg }}</td>
    <td>{{ '%.1f' % std }}</td>
  </tr>
  {% endfor %}
</table>
{% else %}
<p>No ELO data yet.</p>
{% endif %}
{% endblock %}
