{% extends "base.html" %}
{% block title %}Statistics{% endblock %}
{% block content %}
<h2>Global ELO Ranking</h2>
{% if elo_ranking %}
<table class="stats-table">
  <thead>
    <tr><th data-type="number">#</th><th>Preview</th><th data-type="string">Media</th><th data-type="number">ELO</th><th data-type="number">Ratings</th></tr>
  </thead>
  <tbody>
  {% for media, elo, cnt in elo_ranking %}
  <tr>
    <td>{{ loop.index }}</td>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.1f' % elo }}</td>
    <td>{{ cnt }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>No rankings yet.</p>
{% endif %}
<h2>Your Highest Rated Media</h2>
{% if user_highest %}
<table class="stats-table">
  <thead>
    <tr><th>Preview</th><th data-type="string">Media</th><th data-type="number">Your ELO</th><th data-type="number">Global ELO</th><th data-type="number">You Ranked # Times</th><th data-type="number">Globally Ranked # Times</th></tr>
  </thead>
  <tbody>
  {% for media, user_score, global_score, user_cnt, global_cnt in user_highest %}
  <tr>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.1f' % user_score }}</td>
    <td>{{ '%.1f' % global_score }}</td>
    <td>{{ user_cnt }}</td>
    <td>{{ global_cnt }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>No ratings yet.</p>
{% endif %}

<h2>Global Highest Rated Media</h2>
{% if global_highest %}
<table class="stats-table">
  <thead>
    <tr><th>Preview</th><th data-type="string">Media</th><th data-type="number">Global ELO</th><th data-type="number">Your ELO</th><th data-type="number">Globally Ranked # Times</th><th data-type="number">You Ranked # Times</th></tr>
  </thead>
  <tbody>
  {% for media, global_score, user_score, global_cnt, user_cnt in global_highest %}
  <tr>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.1f' % global_score }}</td>
    <td>{{ '%.1f' % user_score if user_score is not none else 'N/A' }}</td>
    <td>{{ global_cnt }}</td>
    <td>{{ user_cnt }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>No ratings yet.</p>
{% endif %}

<h2>Your Lowest Rated Media</h2>
{% if user_lowest %}
<table class="stats-table">
  <thead>
    <tr><th>Preview</th><th data-type="string">Media</th><th data-type="number">Your ELO</th><th data-type="number">Global ELO</th><th data-type="number">You Ranked # Times</th><th data-type="number">Globally Ranked # Times</th></tr>
  </thead>
  <tbody>
  {% for media, user_score, global_score, user_cnt, global_cnt in user_lowest %}
  <tr>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.1f' % user_score }}</td>
    <td>{{ '%.1f' % global_score }}</td>
    <td>{{ user_cnt }}</td>
    <td>{{ global_cnt }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>No ratings yet.</p>
{% endif %}

<h2>Global Lowest Rated Media</h2>
{% if global_lowest %}
<table class="stats-table">
  <thead>
    <tr><th>Preview</th><th data-type="string">Media</th><th data-type="number">Global ELO</th><th data-type="number">Your ELO</th><th data-type="number">Globally Ranked # Times</th><th data-type="number">You Ranked # Times</th></tr>
  </thead>
  <tbody>
  {% for media, global_score, user_score, global_cnt, user_cnt in global_lowest %}
  <tr>
    <td><img class="thumbnail" src="/media/{{ media }}" alt="{{ media }}" /></td>
    <td>{{ media }}</td>
    <td>{{ '%.1f' % global_score }}</td>
    <td>{{ '%.1f' % user_score if user_score is not none else 'N/A' }}</td>
    <td>{{ global_cnt }}</td>
    <td>{{ user_cnt }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>No ratings yet.</p>
{% endif %}

<h2>Media Summary</h2>
<p>Total ratings: {{ rating_total }}</p>
<p>Total files: {{ media_total }}</p>
<h2>ELO Stats by Name</h2>
{% if name_group_stats %}
<table class="stats-table">
  <thead>
    <tr><th data-type="string">Name</th><th data-type="number">Files</th><th data-type="number">Ratings</th><th data-type="number">Min</th><th data-type="number">Max</th><th data-type="number">Avg</th><th data-type="number">Stddev</th></tr>
  </thead>
  <tbody>
  {% for name, count, ratings, mn, mx, avg, std in name_group_stats %}
  <tr>
    <td>{{ name }}</td>
    <td>{{ count }}</td>
    <td>{{ ratings }}</td>
    <td>{{ '%.1f' % mn }}</td>
    <td>{{ '%.1f' % mx }}</td>
    <td>{{ '%.1f' % avg }}</td>
    <td>{{ '%.1f' % std }}</td>
  </tr>
  {% endfor %}
  </tbody>
</table>
{% else %}
<p>No ELO data yet.</p>
{% endif %}
<script src="/static/table-sort.js"></script>
{% endblock %}
