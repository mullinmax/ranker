{% extends "base.html" %}
{% block title %}Rank Media{% endblock %}
{% block content %}
{% if files %}
<div class="media-grid">
  {% for f in files %}
  <div class="media-container" data-file="{{ f }}" onclick="toggleRank(this)">
    <img class="media-preview" src="/media/{{ f }}" alt="{{ f }}" />
    <span class="medal"></span>
  </div>
  {% endfor %}
</div>
<form id="rate-form" action="/rate" method="post">
  <input type="hidden" id="order" name="order" />
  <button id="submit-btn" type="submit" disabled>Submit</button>
</form>
{% else %}
<p>No media files found</p>
{% endif %}
<script>
let selected = [];
const MAX_RANK = 3;
function toggleRank(el){
  const file = el.dataset.file;
  const idx = selected.indexOf(file);
  if(idx >= 0){
    selected.splice(idx,1);
  } else if(selected.length < MAX_RANK){
    selected.push(file);
  }
  update();
}
function update(){
  document.querySelectorAll('.media-container').forEach(c=>{
    const medal = c.querySelector('.medal');
    const idx = selected.indexOf(c.dataset.file);
    medal.textContent = '';
    medal.className = 'medal';
    if(idx === 0){ medal.textContent='ðŸ¥‡'; }
    else if(idx === 1){ medal.textContent='ðŸ¥ˆ'; }
    else if(idx === 2){ medal.textContent='ðŸ¥‰'; }
  });
  let order = [...selected];
  document.querySelectorAll('.media-container').forEach(c=>{
    if(!order.includes(c.dataset.file)) order.push(c.dataset.file);
  });
  document.getElementById('order').value = order.join(',');
  document.getElementById('submit-btn').disabled = selected.length < MAX_RANK;
}
document.addEventListener('keydown', e => {
  const n = parseInt(e.key);
  if(n >= 1 && n <= 4){
    const containers = document.querySelectorAll('.media-container');
    if(containers[n-1]) toggleRank(containers[n-1]);
  }
});
</script>
{% endblock %}
